<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUDIO STUDIO PRO | ULTIMATE STABLE</title>
    <style>
        :root { 
            --gold-line: #d4af37;
            --gold-grad: linear-gradient(135deg, #e5c064 0%, #f9e1a9 50%, #d4af37 100%);
            --chameleon: radial-gradient(circle at 30% 20%, #ffffff 0%, #f4faff 45%, #eef8ff 100%);
            --sidebar-bg: #fcfdfe;
            --text-main: #1a4a7a;
            --accent-gold: #b8860b;
        }
        
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: var(--sidebar-bg); display: flex; height: 100vh; overflow: hidden; color: var(--text-main); }

        /* SIDEBAR LEFT */
        .sidebar-left { width: 320px; background: var(--sidebar-bg); padding: 20px; border-right: 2px solid rgba(212, 175, 55, 0.3); flex-shrink: 0; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; z-index: 10; }
        
        /* SIDEBAR RIGHT (DICTIONARY) */
        .sidebar-right { 
            position: fixed; right: -550px; top: 0; width: 550px; height: 100%; 
            background: white; border-left: 3px solid var(--gold-line); 
            transition: right 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); z-index: 100; 
            display: flex; flex-direction: column; padding: 15px; box-shadow: -10px 0 30px rgba(0,0,0,0.1);
        }
        .sidebar-right.open { right: 0; }
        .toggle-right { 
            position: fixed; right: 0; top: 50%; transform: translateY(-50%); 
            background: var(--gold-grad); border: none; width: 35px; height: 70px; 
            border-radius: 15px 0 0 15px; cursor: pointer; color: white; z-index: 101; font-size: 1.2rem;
        }

        /* MAIN PLAYER ZONE */
        .player-zone { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; background: var(--chameleon); position: relative; }
        
        .cover { 
            width: 75%; max-width: 480px; aspect-ratio: 16/9; border-radius: 20px; background: white; 
            border: 3px solid var(--gold-line); box-shadow: 0 10px 30px rgba(184, 219, 255, 0.2); 
            display: flex; align-items: center; justify-content: center; font-size: 5rem; margin-bottom: 15px; 
            background-size: cover; background-position: center; transition: 0.3s;
        }

        .time { font-weight: 800; font-size: 2rem; margin: 10px 0; font-variant-numeric: tabular-nums; letter-spacing: 1px; }
        #prog { width: 75%; max-width: 480px; accent-color: var(--gold-line); cursor: pointer; height: 10px; margin-bottom: 15px; }
        
        .play-btn { width: 90px; height: 90px; border-radius: 50%; background: var(--gold-grad); color: white; border: none; font-size: 2.8rem; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); }
        .nav-btn { background: none; border: none; color: var(--text-main); font-size: 3.5rem; cursor: pointer; transition: 0.2s; }
        .nav-btn:active { transform: scale(0.9); }

        .slow-btn { background: #5da9e1; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 900; cursor: pointer; width: 100%; text-transform: uppercase; }

        /* CARDS & INPUTS */
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 85%; max-width: 850px; }
        .card { background: white; padding: 12px; border-radius: 18px; border: 2px solid var(--gold-line); box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        
        label { font-size: 0.75rem; font-weight: 900; color: var(--accent-gold); text-transform: uppercase; display: block; margin-bottom: 4px; }
        .input-row { display: flex; align-items: center; gap: 5px; background: #f9fdff; padding: 0 10px; border-radius: 10px; margin-top: 5px; height: 42px; border: 1px solid #eef7fc; position: relative; }
        
        input, select { border: none; background: transparent; width: 100%; outline: none; font-size: 0.9rem; font-weight: 700; color: var(--text-main); }
        
        .hidden-file { position: absolute; width: 100%; height: 100%; left: 0; top: 0; opacity: 0; cursor: pointer; z-index: 2; }
        .custom-file-label { font-size: 0.8rem; font-weight: 800; color: #78a1c4; flex: 1; pointer-events: none; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        .ok-btn { color: var(--gold-line); border: none; background: none; font-weight: 900; cursor: pointer; font-size: 0.9rem; padding: 5px; }
        .x-btn { color: #ff8e8e; border: none; background: none; font-weight: 900; cursor: pointer; font-size: 1.3rem; }

        /* OVERLAYS */
        #lock-screen { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.98); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:9999; border-radius: 20px; }
        #lock-msg { color: #e63946; font-size: 3.5rem; font-weight: 900; text-align: center; }

        iframe { flex: 1; width: 100%; border: 2px solid var(--gold-line); border-radius: 12px; margin-top: 10px; background: #fafafa; }
    </style>
</head>
<body>

<button class="toggle-right" onclick="document.querySelector('.sidebar-right').classList.toggle('open')">üìñ</button>

<div class="sidebar-left">
    <div style="text-align: center; margin-bottom: 10px;">
        <img src="https://irinschensmagen-alt.github.io/Audioplayer-Studio-Pro/logo.png" style="width:75px; border-radius:50%; border:3px solid var(--gold-line);">
        <div style="color:var(--accent-gold); font-weight:900; font-size:1rem; letter-spacing:1px; margin-top:8px;">AUDIO STUDIO PRO</div>
    </div>
    
    <div class="card"><label id="l-lang">LANGUAGE</label><select id="langSelect" onchange="translateUI()"></select></div>
    
    <div class="card"><label id="l-mode">MODE</label>
        <select id="modeSelect" onchange="initMode()">
            <option value="study" id="opt-study"></option>
            <option value="master" id="opt-master"></option>
            <option value="test" id="opt-test"></option>
        </select>
    </div>
    
    <button id="slowBtn" class="slow-btn" onclick="toggleSlow()">üê¢ <span id="l-slow">SLOW 0.8X</span></button>
    
    <div class="card">
        <label id="l-materials">MATERIALS</label>
        <div class="input-row">
            <span class="custom-file-label" id="f-univ-btn">üìÅ Choose file</span>
            <input type="file" id="f-univ" class="hidden-file" onchange="handleFile(this)">
            <button class="x-btn" onclick="clearF('f-univ')">‚úñ</button>
        </div>
    </div>
</div>

<div class="sidebar-right">
    <label id="l-dict-label">ONLINE DICTIONARY</label>
    <div class="input-row">
        <input type="text" id="u-dict" placeholder="https://..." onkeypress="if(event.key==='Enter') loadDict()">
        <button class="ok-btn" onclick="loadDict()">LOAD</button>
        <button class="ok-btn" onclick="window.open(document.getElementById('u-dict').value, '_blank')">‚Üó</button>
        <button class="x-btn" onclick="clearF('u-dict'); document.getElementById('dict-frame').src='about:blank'">‚úñ</button>
    </div>
    <iframe id="dict-frame" src="about:blank"></iframe>
</div>

<div class="player-zone">
    <div id="lock-screen"><h1 id="lock-msg">TIME IS UP</h1></div>
    <div class="cover" id="cover">‚ô´</div>
    <input type="range" id="prog" value="0" step="0.1" oninput="manualSeek(this.value)">
    <div class="time" id="time-display">00:00 / 00:00</div>
    
    <div style="display:flex; align-items:center; gap:45px;">
        <button class="nav-btn" id="rw-btn" onclick="rewind(-10)">‚è™</button>
        <button class="play-btn" id="play-btn" onclick="togglePlay()">‚ñ∂</button>
        <button class="nav-btn" id="ff-btn" onclick="rewind(10)">‚è©</button>
    </div>
    
    <div class="grid-container" style="margin-top:25px;">
        <div class="card"><label id="l-al">AUDIO SOURCE</label>
            <div class="input-row">
                <input type="text" id="u-aud" onkeypress="if(event.key==='Enter') setAudioLink(this.value)">
                <button class="ok-btn" onclick="setAudioLink(document.getElementById('u-aud').value)">OK</button>
                <button class="x-btn" onclick="clearF('u-aud')">‚úñ</button>
            </div>
            <div class="input-row">
                <span class="custom-file-label" id="f-aud-btn">üìÅ Choose file</span>
                <input type="file" id="f-aud" class="hidden-file" accept="audio/*" onchange="handleFile(this)">
                <button class="x-btn" onclick="clearF('f-aud')">‚úñ</button>
            </div>
        </div>
        
        <div class="card"><label id="l-il">IMAGE SOURCE</label>
            <div class="input-row">
                <input type="text" id="u-img" onkeypress="if(event.key==='Enter') setI(this.value)">
                <button class="ok-btn" onclick="setI(document.getElementById('u-img').value)">OK</button>
                <button class="x-btn" onclick="clearF('u-img')">‚úñ</button>
            </div>
            <div class="input-row">
                <span class="custom-file-label" id="f-img-btn">üìÅ Choose file</span>
                <input type="file" id="f-img" class="hidden-file" accept="image/*" onchange="handleFile(this)">
                <button class="x-btn" onclick="clearF('f-img')">‚úñ</button>
            </div>
        </div>
    </div>
</div>

<script>
    const audio = new Audio();
    audio.preservesPitch = true; 
    let testTimer = null;
    let playCount = 0;

    const langs = {
        ru: { name: "–†—É—Å—Å–∫–∏–π", lang: "–Ø–ó–´–ö", mode: "–†–ï–ñ–ò–ú", slow: "–ó–ê–ú–ï–î–õ–ï–ù–ò–ï 0.8x", materials: "–ú–ê–¢–ï–†–ò–ê–õ–´", al: "–ê–£–î–ò–û", il: "–§–û–¢–û", study: "–£—á–µ–Ω–∏–∫", master: "–ú–∞—Å—Ç–µ—Ä", test: "–¢–µ—Å—Ç", select: "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª", nofile: "–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω", link: "–°—Å—ã–ª–∫–∞", dict: "–°–ª–æ–≤–∞—Ä—å", timeup: "–í–†–ï–ú–Ø –í–´–®–õ–û", load: "–ó–∞–≥—Ä—É–∑–∏—Ç—å" },
        en: { name: "English", lang: "LANGUAGE", mode: "MODE", slow: "SLOW 0.8x", materials: "MATERIALS", al: "AUDIO", il: "IMAGE", study: "Study", master: "Master", test: "Test", select: "Choose file", nofile: "No file chosen", link: "Link", dict: "Dictionary", timeup: "TIME IS UP", load: "Load" },
        fr: { name: "Fran√ßais", lang: "LANGUE", mode: "MODE", slow: "LENT 0.8x", materials: "MAT√âRIELS", al: "AUDIO", il: "IMAGE", study: "√âtude", master: "Ma√Ætre", test: "Test", select: "Choisir un fichier", nofile: "Aucun —Ñ–∞–π–ª", link: "Lien", dict: "Dictionnaire", timeup: "TEMPS √âCOUL√â", load: "Charger" },
        it: { name: "Italiano", lang: "LINGUA", mode: "MODO", slow: "LENTO 0.8x", materials: "MATERIALI", al: "AUDIO", il: "IMMAGINE", study: "Studio", master: "Master", test: "Test", select: "Scegli file", nofile: "Nessun file", link: "Link", dict: "Dizionario", timeup: "TEMPO SCADUTO", load: "Carica" },
        es: { name: "Espa√±ol", lang: "IDIOMA", mode: "MODO", slow: "LENTO 0.8x", materials: "MATERIALES", al: "AUDIO", il: "IMAGEN", study: "Estudio", master: "Maestro", test: "Prueba", select: "Elegir archivo", nofile: "Sin archivo", link: "Enlace", dict: "Diccionario", timeup: "TIEMPO AGOTADO", load: "Subir" },
        pt: { name: "Portugu√™s", lang: "IDIOMA", mode: "MODO", slow: "LENTO 0.8x", materials: "MATERIAIS", al: "√ÅUDIO", il: "IMAGEM", study: "Estudo", master: "Mestre", test: "Teste", select: "Escolher", nofile: "Nenhum arquivo", link: "Link", dict: "Dicion√°rio", timeup: "TEMPO ESGOTADO", load: "Carregar" },
        ja: { name: "Êó•Êú¨Ë™û", lang: "Ë®ÄË™û", mode: "„É¢„Éº„Éâ", slow: "„Çπ„É≠„Éº 0.8x", materials: "ÊïôÊùê", al: "„Ç™„Éº„Éá„Ç£„Ç™", il: "ÁîªÂÉè", study: "Â≠¶Áøí", master: "„Éû„Çπ„Çø„Éº", test: "„ÉÜ„Çπ„Éà", select: "„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû", nofile: "Êú™ÈÅ∏Êäû", link: "„É™„É≥„ÇØ", dict: "ËæûÊõ∏", timeup: "ÊôÇÈñìÂàá„Çå", load: "Ë™≠„ÅøËæº„ÇÄ" },
        zh: { name: "‰∏≠Êñá", lang: "ËØ≠Ë®Ä", mode: "Ê®°Âºè", slow: "ÊÖ¢Êîæ 0.8x", materials: "ÊùêÊñô", al: "Èü≥È¢ë", il: "ÂõæÁâá", study: "Â≠¶‰π†", master: "Â§ßÂ∏à", test: "ÊµãËØï", select: "ÈÄâÊã©Êñá‰ª∂", nofile: "Êú™ÈÄâÊã©", link: "ÈìæÊé•", dict: "ËØçÂÖ∏", timeup: "Êó∂Èó¥Âà∞", load: "Âä†ËΩΩ" },
        hi: { name: "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä", lang: "‡§≠‡§æ‡§∑‡§æ", mode: "‡§Æ‡•ã–¥", slow: "‡§ß‡•Ä‡§Æ‡•Ä ‡§ó‡§§‡§ø 0.8x", materials: "‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä", al: "‡§ë‡§°‡§ø‡§Ø‡•ã", il: "‡§õ‡§µ‡§ø", study: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§®", master: "‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞", test: "‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ", select: "‡§´‡§º‡§æ‡§á‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç", nofile: "‡§ï‡•ã‡§à ‡§´‡§º‡§æ‡§á‡§≤ ‡§®‡§π‡•Ä‡§Ç", link: "‡§≤‡§ø‡§Ç‡§ï", dict: "‡§∂‡§¨‡•ç‡§¶‡§ï‡•ã‡§∂", timeup: "‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§", load: "‡§≤‡•ã‡§°" },
        ar: { name: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©", lang: "ÿßŸÑŸÑÿ∫ÿ©", mode: "ÿßŸÑŸàÿ∂ÿπ", slow: "ÿ®ÿ∑Ÿäÿ° 0.8x", materials: "ÿßŸÑŸÖŸàÿßÿØ", al: "ÿµŸàÿ™", il: "ÿµŸàÿ±ÿ©", study: "ÿØÿ±ÿßÿ≥ÿ©", master: "ŸÖÿßÿ≥ÿ™ÿ±", test: "ÿßÿÆÿ™ÿ®ÿßÿ±", select: "ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ", nofile: "ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸÑŸÅ", link: "ÿ±ÿßÿ®ÿ∑", dict: "ŸÇÿßŸÖŸàÿ≥", timeup: "ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™", load: "ÿ™ÿ≠ŸÖŸäŸÑ" },
        fa: { name: "ŸÅÿßÿ±ÿ≥€å", lang: "ÿ≤ÿ®ÿßŸÜ", mode: "ÿ≠ÿßŸÑÿ™", slow: "ÿ¢Ÿáÿ≥ÿ™Ÿá 0.8x", materials: "ŸÖŸàÿßÿØ", al: "ÿµŸàÿ™€å", il: "ÿ™ÿµŸà€åÿ±", study: "ŸÖÿ∑ÿßŸÑÿπŸá", master: "ÿßÿ≥ÿ™ÿßÿØ", test: "ÿ™ÿ≥ÿ™", select: "ÿßŸÜÿ™ÿÆÿßÿ® ŸÅÿß€åŸÑ", nofile: "ŸÅÿß€åŸÑ€å ŸÜ€åÿ≥ÿ™", link: "ŸÑ€åŸÜ⁄©", dict: "ÿØ€å⁄©ÿ¥ŸÜÿ±€å", timeup: "ÿ≤ŸÖÿßŸÜ ÿ™ŸÖÿßŸÖ ÿ¥ÿØ", load: "ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å" },
        da: { name: "ÿØÿ±€å", lang: "ÿ≤ÿ®ÿßŸÜ", mode: "ÿ≠ÿßŸÑÿ™", slow: "ÿ¢Ÿáÿ≥ÿ™Ÿá 0.8x", materials: "ŸÖŸàÿßÿØ", al: "ÿµŸàÿ™€å", il: "ÿ™ÿµŸà€åÿ±", study: "ŸÖÿ∑ÿßŸÑÿπŸá", master: "ÿßÿ≥ÿ™ÿßÿØ", test: "ÿ™ÿ≥ÿ™", select: "ÿßŸÜÿ™ÿÆÿßÿ® ŸÅÿß€åŸÑ", nofile: "ŸÅÿß€åŸÑ€å ŸÜ€åÿ≥ÿ™", link: "ŸÑ€åŸÜ⁄©", dict: "ÿØ€å⁄©ÿ¥ŸÜÿ±€å", timeup: "ÿ≤ŸÖÿßŸÜ ÿ™ŸÖÿßŸÖ ÿ¥ÿØ", load: "ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å" }
    };

    const sel = document.getElementById('langSelect');
    Object.keys(langs).forEach(k => sel.add(new Option(langs[k].name, k)));
    sel.value = 'ru';

    function translateUI() {
        const t = langs[sel.value] || langs.ru;
        ['lang','mode','slow','materials','al','il'].forEach(id => document.getElementById('l-'+id).innerText = t[id]);
        ['study','master','test'].forEach(m => document.getElementById('opt-'+m).innerText = t[m]);
        document.getElementById('u-aud').placeholder = t.link;
        document.getElementById('u-img').placeholder = t.link;
        document.getElementById('u-dict').placeholder = t.link;
        document.getElementById('l-dict-label').innerText = t.dict;
        document.getElementById('lock-msg').innerText = t.timeup;
        
        ['f-univ','f-aud','f-img'].forEach(id => {
            const label = document.getElementById(id + '-btn');
            const input = document.getElementById(id);
            label.innerText = input.files[0] ? "üìÑ " + input.files[0].name : "üìÅ " + t.nofile + " / " + t.select;
        });
    }

    // –õ–û–ì–ò–ö–ê –ê–£–î–ò–û –ò –§–ê–ô–õ–û–í
    function setAudioLink(url) {
        if(!url) return;
        audio.pause();
        audio.src = url;
        audio.load();
        audio.play().catch(() => console.log("Waiting for user..."));
        playCount = 0;
    }

    function handleFile(input) {
        const label = document.getElementById(input.id + '-btn');
        if (input.files[0]) {
            label.innerText = "üìÑ " + input.files[0].name;
            const url = URL.createObjectURL(input.files[0]);
            if(input.id === 'f-aud') { audio.src = url; audio.load(); playCount = 0; }
            if(input.id === 'f-img') setI(url);
        }
    }

    function clearF(id) {
        const input = document.getElementById(id);
        if(input) input.value = '';
        if(id.startsWith('f-')) translateUI();
        if(id.includes('aud')) { audio.pause(); audio.src = ''; }
        if(id.includes('img')) setI('');
    }

    function loadDict() {
        let url = document.getElementById('u-dict').value;
        if(url && !url.startsWith('http')) url = 'https://' + url;
        document.getElementById('dict-frame').src = url || 'about:blank';
    }

    // –†–ï–ñ–ò–ú–´ –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï
    function initMode() {
        const mode = document.getElementById('modeSelect').value;
        document.getElementById('lock-screen').style.display = 'none';
        clearInterval(testTimer);
        
        // –í Test Mode –±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–æ—Ç–∫—É –∏ —Å—Ç–∞–≤–∏–º —Ç–∞–π–º–µ—Ä
        const isTest = mode === 'test';
        document.getElementById('ff-btn').style.pointerEvents = isTest ? 'none' : 'auto';
        document.getElementById('ff-btn').style.opacity = isTest ? '0.3' : '1';
        document.getElementById('prog').style.pointerEvents = isTest ? 'none' : 'auto';

        if(isTest) {
            let timeLeft = 120;
            testTimer = setInterval(() => {
                if(!audio.paused) timeLeft--;
                if(timeLeft <= 0) {
                    audio.pause();
                    document.getElementById('lock-screen').style.display = 'flex';
                    clearInterval(testTimer);
                }
            }, 1000);
        }
    }

    function togglePlay() { 
        if(!audio.src) return;
        if(audio.paused) {
            audio.play();
            if(document.getElementById('modeSelect').value === 'study') playCount++;
        } else {
            audio.pause();
        }
    }

    function rewind(v) { 
        const mode = document.getElementById('modeSelect').value;
        if(mode === 'test') return;
        if(mode === 'study' && v > 0 && playCount > 2) return; // –ë–ª–æ–∫ –ø–µ—Ä–µ–º–æ—Ç–∫–∏ –≤–ø–µ—Ä–µ–¥ –Ω–∞ 3-–π —Ä–∞–∑ –≤ Study
        audio.currentTime += v; 
    }

    function manualSeek(v) { if(document.getElementById('modeSelect').value !== 'test') audio.currentTime = v; }

    function toggleSlow() {
        audio.playbackRate = (audio.playbackRate === 1 ? 0.8 : 1);
        document.getElementById('slowBtn').style.background = audio.playbackRate === 0.8 ? 'var(--gold-grad)' : '#5da9e1';
    }

    function setI(u) { 
        const c = document.getElementById('cover');
        c.style.backgroundImage = u ? `url(${u})` : 'none'; 
        c.innerText = u ? '' : '‚ô´'; 
    }

    audio.ontimeupdate = () => {
        const pr = document.getElementById('prog'); 
        pr.max = audio.duration || 0; 
        pr.value = audio.currentTime;
        const f = s => new Date(s * 1000).toISOString().substr(14, 5);
        document.getElementById('time-display').innerText = `${f(audio.currentTime)} / ${f(audio.duration || 0)}`;
    };
    audio.onplay = () => document.getElementById('play-btn').innerText = '‚è∏';
    audio.onpause = () => document.getElementById('play-btn').innerText = '‚ñ∂';
    
    translateUI();
    initMode();
</script>
</body>
</html>
