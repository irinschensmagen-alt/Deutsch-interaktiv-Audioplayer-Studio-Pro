<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Studio Ultimate Gold</title>
    <style>
        :root { 
            --gold: linear-gradient(135deg, #d4af37, #f1c40f, #c5a028);
            --gold-text: #b8860b;
            --bg: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
            --panel-bg: rgba(255, 255, 255, 0.95);
        }
        
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); color: #555; display: flex; height: 100vh; overflow: hidden; }
        .container { display: grid; grid-template-columns: 340px 1fr; width: 100%; }
        
        /* –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings { background: var(--panel-bg); padding: 20px; border-right: 1px solid #ddd; display: flex; flex-direction: column; overflow-y: auto; box-shadow: 5px 0 15px rgba(0,0,0,0.05); }
        .header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; border-bottom: 2px solid #f1c40f; padding-bottom: 10px; }
        .logo-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #d4af37; box-shadow: 0 0 10px rgba(212,175,55,0.3); }
        
        /* –ü–ª–µ–µ—Ä */
        .player-view { padding: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .cover { width: 100%; max-width: 450px; height: 250px; border-radius: 20px; background: #fff center/cover no-repeat; border: 5px solid #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; position: relative; }
        .cover:empty::before { content: "üéµ"; font-size: 50px; opacity: 0.1; }

        label { display: block; font-size: 0.7rem; font-weight: bold; margin-top: 12px; color: var(--gold-text); text-transform: uppercase; }
        select, input, textarea { width: 100%; padding: 9px; border-radius: 10px; border: 1px solid #ccc; margin-top: 4px; font-size: 0.85rem; box-sizing: border-box; }
        input[type="file"] { font-size: 0.7rem; padding: 5px; background: #fff; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 12px; background: var(--gold); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3); }

        .controls { display: flex; gap: 20px; align-items: center; margin: 20px 0; }
        .c-btn { width: 45px; height: 45px; border-radius: 12px; border: none; background: #fff; color: #d4af37; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        #play { width: 65px; height: 65px; border-radius: 50%; background: var(--gold); color: white; font-size: 1.5rem; }
        
        #prog { width: 100%; max-width: 500px; accent-color: #d4af37; cursor: pointer; }
        #time { font-family: monospace; font-weight: bold; color: var(--gold-text); margin-top: 5px; }
        #test-timer { font-size: 1.5rem; font-weight: bold; color: #e74c3c; margin-bottom: 10px; display: none; }

        #lock-screen { position: absolute; inset: 0; background: rgba(255,255,255,0.98); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body>

<div id="lock-screen">
    <h1 id="lock-h1" style="color:#d4af37">Time is up</h1>
    <p id="lock-p">–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.</p>
    <button class="btn" style="width:150px" onclick="location.reload()">Restart</button>
</div>

<div class="container">
    <div class="settings">
        <div class="header">
            <img id="main-logo" src="https://via.placeholder.com/50/d4af37/ffffff?text=LOGO" class="logo-img" alt="Logo">
            <h3 id="ui-title" style="margin:0; font-size:1rem;">Audio Editor</h3>
        </div>

        <label id="lbl-lang">üåê –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫</label>
        <select id="lang">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="de">Deutsch</option>
            <option value="en">English</option>
        </select>

        <label id="lbl-mode">üéì –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</label>
        <select id="mode">
            <option value="master">Master (–£—á–∏—Ç–µ–ª—å)</option>
            <option value="study" selected>Study (–£—á–µ–Ω–∏–∫)</option>
            <option value="test">Test (–≠–∫–∑–∞–º–µ–Ω)</option>
        </select>

        <button class="btn" id="slowBtn" style="background:#00b894; display:none">üê¢ Slow 0.8x</button>
        <button class="btn" id="loopBtn" style="background:#0984e3; display:none">üîÑ Loop: Off</button>

        <label id="lbl-code" style="margin-top:15px">üì¶ –ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏</label>
        <textarea id="code-out" readonly></textarea>
        <button class="btn" id="copy-btn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
    </div>

    <div class="player-view">
        <div id="test-timer">02:00</div>
        <div id="status-msg" style="color:#d4af37; font-weight:bold; margin-bottom:10px;"></div>
        <div class="cover" id="cover"></div>
        
        <input type="range" id="prog" value="0" step="0.1">
        <div id="time">00:00 / 00:00</div>

        <div class="controls">
            <button class="c-btn" id="rew">‚è™</button>
            <button class="c-btn" id="play">‚ñ∂</button>
            <button class="c-btn" id="fwd">‚è©</button>
        </div>

        <div style="width:100%; max-width:500px; display: grid; gap: 5px;">
            <label id="lbl-aud">üîó –ê—É–¥–∏–æ (–°—Å—ã–ª–∫–∞ –∏–ª–∏ –§–∞–π–ª)</label>
            <input type="text" id="audUrl" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ URL...">
            <input type="file" id="audFile" accept="audio/*">

            <label id="lbl-img">üñºÔ∏è –û–±–ª–æ–∂–∫–∞ (–°—Å—ã–ª–∫–∞ –∏–ª–∏ –§–∞–π–ª)</label>
            <input type="text" id="imgUrl" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ URL...">
            <input type="file" id="imgFile" accept="image/*">
        </div>
    </div>
</div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò –í–õ–ê–î–ï–õ–¨–¶–ê ---
    const MY_LOGO_URL = "https://via.placeholder.com/50/d4af37/ffffff?text=MY_LOGO"; // –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —Å–≤–æ–π –ª–æ–≥–æ
    document.getElementById('main-logo').src = MY_LOGO_URL;

    const audio = new Audio();
    let plays = 0;
    let timer;
    let timeLeft = 120;

    const dictionary = {
        ru: { title: "–ê—É–¥–∏–æ –†–µ–¥–∞–∫—Ç–æ—Ä", lang: "üåê –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫", mode: "üéì –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã", code: "üì¶ –ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏", copy: "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥", aud: "üîó –ê—É–¥–∏–æ (–°—Å—ã–ª–∫–∞ –∏–ª–∏ –§–∞–π–ª)", img: "üñºÔ∏è –û–±–ª–æ–∂–∫–∞ (–°—Å—ã–ª–∫–∞ –∏–ª–∏ –§–∞–π–ª)", slow: "üê¢ –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ 0.8x", lockH: "–í—Ä–µ–º—è –≤—ã—à–ª–æ", lockP: "–≠–∫–∑–∞–º–µ–Ω –æ–∫–æ–Ω—á–µ–Ω.", attempt: "–ü–æ–ø—ã—Ç–∫–∞" },
        de: { title: "Audio Editor", lang: "üåê Sprache w√§hlen", mode: "üéì Modus", code: "üì¶ Einbettungscode", copy: "Code kopieren", aud: "üîó Audio (Link oder Datei)", img: "üñºÔ∏è Cover (Link oder Datei)", slow: "üê¢ Zeitlupe 0.8x", lockH: "Zeit um", lockP: "Pr√ºfung beendet.", attempt: "Versuch" },
        en: { title: "Audio Editor", lang: "üåê Choose Language", mode: "üéì Mode", code: "üì¶ Embed Code", copy: "Copy Code", aud: "üîó Audio (URL or File)", img: "üñºÔ∏è Cover (URL or File)", slow: "üê¢ Slow Motion 0.8x", lockH: "Time is up", lockP: "Exam finished.", attempt: "Attempt" }
    };

    function updateLanguage() {
        const l = dictionary[document.getElementById('lang').value];
        document.getElementById('ui-title').innerText = l.title;
        document.getElementById('lbl-lang').innerText = l.lang;
        document.getElementById('lbl-mode').innerText = l.mode;
        document.getElementById('lbl-code').innerText = l.code;
        document.getElementById('copy-btn').innerText = l.copy;
        document.getElementById('lbl-aud').innerText = l.aud;
        document.getElementById('lbl-img').innerText = l.img;
        document.getElementById('slowBtn').innerText = l.slow;
        document.getElementById('lock-h1').innerText = l.lockH;
        document.getElementById('lock-p').innerText = l.lockP;
        updateStatus();
    }

    function updateStatus() {
        const m = document.getElementById('mode').value;
        const l = dictionary[document.getElementById('lang').value];
        if(m !== 'master') {
            document.getElementById('status-msg').innerText = `${l.attempt}: ${plays + 1} / 2`;
        } else {
            document.getElementById('status-msg').innerText = "";
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
    document.getElementById('audUrl').oninput = (e) => {
        let url = e.target.value.trim();
        if(url.includes('dropbox.com')) url = url.replace('dl=0', 'raw=1');
        audio.src = url; plays = 0; updateStatus();
    };
    document.getElementById('audFile').onchange = (e) => {
        audio.src = URL.createObjectURL(e.target.files[0]); plays = 0; updateStatus();
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–æ–∂–∫–∏
    document.getElementById('imgUrl').oninput = (e) => {
        document.getElementById('cover').style.backgroundImage = `url(${e.target.value})`;
    };
    document.getElementById('imgFile').onchange = (e) => {
        document.getElementById('cover').style.backgroundImage = `url(${URL.createObjectURL(e.target.files[0])})`;
    };

    // –õ–æ–≥–∏–∫–∞ —Ä–µ–∂–∏–º–æ–≤
    document.getElementById('mode').onchange = function() {
        const m = this.value;
        plays = 0; timeLeft = 120; clearInterval(timer);
        audio.loop = false; audio.playbackRate = 1;
        
        document.getElementById('test-timer').style.display = (m === 'test') ? 'block' : 'none';
        document.getElementById('slowBtn').style.display = (m === 'study') ? 'block' : 'none';
        document.getElementById('loopBtn').style.display = (m === 'master') ? 'block' : 'none';
        
        const isTest = (m === 'test');
        document.getElementById('prog').style.pointerEvents = isTest ? 'none' : 'auto';
        document.getElementById('rew').disabled = isTest;
        document.getElementById('fwd').disabled = isTest;
        updateStatus();
    };

    document.getElementById('play').onclick = () => {
        if(!audio.src) return;
        if(audio.paused) {
            audio.play();
            if(document.getElementById('mode').value === 'test' && !timer) startTimer();
        } else {
            audio.pause();
        }
        document.getElementById('play').innerText = audio.paused ? '‚ñ∂' : '‚è∏';
    };

    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft / 60), s = timeLeft % 60;
            document.getElementById('test-timer').innerText = `${m}:${s<10?'0':''}${s}`;
            if(timeLeft <= 0) { clearInterval(timer); audio.pause(); document.getElementById('lock-screen').style.display='flex'; }
        }, 1000);
    }

    audio.onplay = () => {
        const m = document.getElementById('mode').value;
        if((m==='study'||m==='test') && audio.currentTime === 0) {
            plays++; updateStatus();
            if(plays > 2) { audio.pause(); document.getElementById('lock-screen').style.display='flex'; }
            if(m==='study' && plays >= 3) { // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–º–æ—Ç–∫–∏ –Ω–∞ 3-–π –ø–æ–ø—ã—Ç–∫–µ
                document.getElementById('prog').style.pointerEvents = 'none';
                document.getElementById('rew').disabled = true; document.getElementById('fwd').disabled = true;
            }
        }
    };

    audio.ontimeupdate = () => {
        const p = document.getElementById('prog');
        p.max = audio.duration || 0; p.value = audio.currentTime;
        const fmt = s => new Date(s * 1000).toISOString().substr(14, 5);
        document.getElementById('time').innerText = `${fmt(audio.currentTime)} / ${fmt(audio.duration || 0)}`;
    };

    document.getElementById('prog').oninput = (e) => audio.currentTime = e.target.value;
    document.getElementById('rew').onclick = () => audio.currentTime -= 10;
    document.getElementById('fwd').onclick = () => audio.currentTime += 10;
    document.getElementById('slowBtn').onclick = () => audio.playbackRate = (audio.playbackRate === 1) ? 0.8 : 1;
    document.getElementById('loopBtn').onclick = function() { audio.loop = !audio.loop; this.innerText = audio.loop ? "üîÑ Loop: ON" : "üîÑ Loop: OFF"; };
    document.getElementById('lang').onchange = updateLanguage;

    document.getElementById('copy-btn').onclick = () => {
        const frame = `<iframe src="${window.location.href}" width="100%" height="650" frameborder="0" scrolling="no" style="border-radius:20px;"></iframe>`;
        document.getElementById('code-out').value = frame;
        navigator.clipboard.writeText(frame);
        alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
    };

    updateLanguage();
</script>
</body>
</html>
