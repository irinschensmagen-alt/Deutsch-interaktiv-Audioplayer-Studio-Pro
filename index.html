<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Studio Pro - Full Study Suite</title>
    <style>
        :root { 
            --gold: linear-gradient(135deg, #d4af37, #f1c40f, #c5a028);
            --gold-text: #b8860b;
            --danger: #e74c3c;
            --success: #27ae60;
        }

        @keyframes chameleon {
            0% { background-color: #f3e5f5; }
            50% { background-color: #e8f5e9; }
            100% { background-color: #f3e5f5; }
        }

        body { 
            font-family: 'Segoe UI', sans-serif; margin: 0; 
            animation: chameleon 20s infinite alternate;
            color: #444; display: flex; height: 100vh; overflow: hidden; 
        }

        .container { display: grid; grid-template-columns: 320px 1fr 400px; width: 100%; transition: 0.5s; }
        .container.test-mode { grid-template-columns: 320px 1fr 0px; }

        .settings { background: rgba(255, 255, 255, 0.9); padding: 20px; border-right: 1px solid rgba(0,0,0,0.05); overflow-y: auto; backdrop-filter: blur(10px); }
        .player-view { padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; overflow-y: auto; }
        
        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ */
        .materials-view { 
            background: rgba(255, 255, 255, 0.85); 
            border-left: 1px solid rgba(0,0,0,0.1); 
            display: flex; flex-direction: column; 
            overflow: hidden; position: relative;
        }

        .header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .logo-img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid #d4af37; }

        .cover { 
            width: 100%; max-width: 400px; height: 220px; border-radius: 20px; 
            background: white center/cover no-repeat; border: 4px solid white; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; 
            margin-bottom: 15px; 
        }

        label { display: block; font-size: 0.65rem; font-weight: 800; margin-top: 10px; color: var(--gold-text); text-transform: uppercase; }
        select, input, textarea { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; margin-top: 4px; font-size: 0.8rem; }

        .btn { width: 100%; padding: 10px; border: none; border-radius: 10px; background: var(--gold); color: white; font-weight: 700; cursor: pointer; margin-top: 8px; font-size: 0.85rem; }
        .btn-del { background: rgba(0,0,0,0.05); color: #888; padding: 3px 6px; font-size: 0.6rem; border-radius: 4px; cursor: pointer; border: none; }

        .controls { display: flex; gap: 12px; align-items: center; margin: 15px 0; }
        .c-btn { width: 40px; height: 40px; border-radius: 10px; border: none; background: white; color: #d4af37; cursor: pointer; box-shadow: 0 3px 8px rgba(0,0,0,0.05); }
        #play-btn { width: 60px; height: 60px; border-radius: 50%; background: var(--gold); color: white; font-size: 1.5rem; }

        #prog { width: 100%; max-width: 450px; accent-color: #d4af37; }
        
        .card { background: white; padding: 12px; border-radius: 12px; margin-top: 8px; width: 100%; max-width: 450px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ—Ä–µ–π–º–æ–≤ */
        .viewer-container { flex-grow: 1; position: relative; background: #eee; }
        iframe { width: 100%; height: 100%; border: none; }
        
        .mat-tabs { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 10px; border: none; cursor: pointer; background: #ddd; font-weight: bold; font-size: 0.7rem; }
        .tab-btn.active { background: var(--gold); color: white; }

        #lock-screen { position: absolute; inset: 0; background: white; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="lock-screen">
    <h1 style="color:var(--danger); font-size: 2.5rem;" id="lock-title">Time is up</h1>
    <button class="btn" style="width:180px" onclick="location.reload()">Restart</button>
</div>

<div class="container" id="main-container">
    <div class="settings">
        <div class="header">
            <img id="main-logo" src="https://irinschensmagen-alt.github.io/Audioplayer-Studio-Pro/logo.png" class="logo-img" alt="Logo">
            <h3 id="ui-title">Studio</h3>
        </div>

        <label id="lbl-lang">Language</label>
        <select id="langSelect" onchange="translate()">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="de" selected>Deutsch</option>
            <option value="en">English</option>
            </select>

        <label id="lbl-mode">Mode</label>
        <select id="modeSelect" onchange="handleModeChange()">
            <option value="master">Master (Loop)</option>
            <option value="study" selected>Study</option>
            <option value="test">Test (Exam)</option>
        </select>

        <button class="btn" id="slowBtn" onclick="toggleSlow()">üê¢ SLOW 0.8x</button>

        <div id="extra-inputs">
            <label id="lbl-doc">Upload PDF / Doc</label>
            <input type="file" id="docFile" accept=".pdf,.doc,.docx,.txt">

            <label id="lbl-dict-url">Dictionary URL</label>
            <div style="display:flex; gap:5px;">
                <input type="text" id="dictUrl" placeholder="https://...">
                <button class="c-btn" style="width:35px; margin-top:4px;" onclick="openExternalDict()" title="Open in new window">‚Üó</button>
            </div>
        </div>

        <label id="lbl-code" style="margin-top:15px">Embed Code</label>
        <textarea id="code-out" rows="2" readonly></textarea>
        <button class="btn" onclick="copyCode()">Copy Code</button>
    </div>

    <div class="player-view">
        <div id="status-display"></div>
        <div class="cover" id="cover-div"></div>
        <input type="range" id="prog" value="0" step="0.1" oninput="audio.currentTime=this.value">
        <div id="time-txt">00:00 / 00:00</div>
        
        <div class="controls">
            <button class="c-btn" onclick="audio.currentTime-=10">‚è™</button>
            <button class="c-btn" id="play-btn" onclick="togglePlay()">‚ñ∂</button>
            <button class="c-btn" onclick="audio.currentTime+=10">‚è©</button>
        </div>

        <div class="card">
            <label>Audio File/URL</label>
            <input type="text" id="audUrl" oninput="audio.src=this.value" placeholder="URL...">
            <input type="file" id="audFile" accept="audio/*" onchange="audio.src=URL.createObjectURL(this.files[0])">
        </div>
    </div>

    <div class="materials-view" id="mat-panel">
        <div class="mat-tabs">
            <button class="tab-btn active" onclick="switchTab('dict')">DICTIONARY</button>
            <button class="tab-btn" onclick="switchTab('doc')">DOCUMENT</button>
        </div>
        <div class="viewer-container">
            <iframe id="dict-frame" src=""></iframe>
            <iframe id="doc-frame" style="display:none;" src=""></iframe>
            <div id="hint-text" style="padding:20px; color:#888; font-size:0.8rem; text-align:center;">
                If the dictionary is blocked, use the ‚Üó button on the left to open it in a new window.
            </div>
        </div>
    </div>
</div>

<script>
    const audio = new Audio();
    let plays = 0;

    function handleModeChange() {
        const m = document.getElementById('modeSelect').value;
        const container = document.getElementById('main-container');
        const extras = document.getElementById('extra-inputs');
        
        if(m === 'test') {
            container.classList.add('test-mode');
            extras.style.display = 'none';
        } else {
            container.classList.remove('test-mode');
            extras.style.display = 'block';
        }
        
        audio.playbackRate = 1;
        document.getElementById('slowBtn').style.display = (m === 'study') ? 'block' : 'none';
        updateStatus();
    }

    function switchTab(type) {
        const d = document.getElementById('dict-frame');
        const f = document.getElementById('doc-frame');
        const btns = document.querySelectorAll('.tab-btn');
        
        if(type === 'dict') {
            d.style.display = 'block'; f.style.display = 'none';
            btns[0].classList.add('active'); btns[1].classList.remove('active');
        } else {
            d.style.display = 'none'; f.style.display = 'block';
            btns[1].classList.add('active'); btns[0].classList.remove('active');
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    document.getElementById('docFile').onchange = function(e) {
        if(this.files[0]) {
            const url = URL.createObjectURL(this.files[0]);
            document.getElementById('doc-frame').src = url;
            switchTab('doc');
        }
    };

    // –°–ª–æ–≤–∞—Ä—å
    document.getElementById('dictUrl').oninput = function() {
        document.getElementById('dict-frame').src = this.value;
        document.getElementById('hint-text').style.display = this.value ? 'none' : 'block';
    };

    function openExternalDict() {
        const url = document.getElementById('dictUrl').value;
        if(url) window.open(url, 'dictWin', 'width=500,height=700');
        else alert("Please enter URL first");
    }

    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–ª–µ–µ—Ä–∞
    function togglePlay() { if(audio.src) audio.paused ? audio.play() : audio.pause(); }
    function toggleSlow() { 
        audio.playbackRate = (audio.playbackRate === 1) ? 0.8 : 1;
        document.getElementById('slowBtn').style.background = (audio.playbackRate === 0.8) ? "#e67e22" : "var(--success)";
    }

    audio.onplay = () => {
        if(document.getElementById('modeSelect').value === 'test' && audio.currentTime === 0) {
            plays++; updateStatus();
            if(plays > 2) { audio.pause(); document.getElementById('lock-screen').style.display = 'flex'; }
        }
        document.getElementById('play-btn').innerText = '‚è∏';
    };
    audio.onpause = () => document.getElementById('play-btn').innerText = '‚ñ∂';
    audio.ontimeupdate = () => {
        const p = document.getElementById('prog'); p.max = audio.duration || 0; p.value = audio.currentTime;
        const f = s => new Date(s * 1000).toISOString().substr(14, 5);
        document.getElementById('time-txt').innerText = `${f(audio.currentTime)} / ${f(audio.duration || 0)}`;
    };

    function updateStatus() {
        const m = document.getElementById('modeSelect').value;
        document.getElementById('status-display').innerText = (m === 'test') ? `Attempt: ${plays + 1} / 2` : "";
    }

    function copyCode() {
        const code = `<iframe src="${window.location.href}" width="100%" height="700" frameborder="0"></iframe>`;
        navigator.clipboard.writeText(code); alert("Copied!");
    }

    function translate() {
        // –ó–¥–µ—Å—å –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (—Å–æ–∫—Ä–∞—Ç–∏–ª –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)
        const lang = document.getElementById('langSelect').value;
        document.getElementById('ui-title').innerText = (lang === 'ru') ? '–°—Ç—É–¥–∏—è' : 'Studio';
    }

    translate();
    handleModeChange();
</script>
</body>
</html>
